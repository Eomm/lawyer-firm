---
import '../styles/global.css';
import { getTranslations, type Language } from '@/i18n';

export interface Props {
  title: string;
  description: string;
  lang: Language;
  currentPath?: string;
  robots?: string;
}

const { title, description, lang, currentPath = '', robots = 'index, follow' } = Astro.props;

const GA_MEASUREMENT_ID = import.meta.env.PUBLIC_GA_MEASUREMENT_ID ?? false;

const siteUrl = Astro.site?.toString().replace(/\/$/, '');
const fullUrl = `${siteUrl}${currentPath}`;
const t = getTranslations(lang);

const structuredData = {
  '@context': 'https://schema.org',
  '@type': 'LegalService',
  name: 'Studio Legale Ferrini',
  description: 'Rappresentanza legale esperta a Cesena e Rimini. Specializzati in diritto penale da oltre 25 anni.',
  url: siteUrl,
  telephone: t.home.cta.phone,
  email: t.footer.email,
  address: {
    '@type': 'PostalAddress',
    streetAddress: t.whereWeAre.locations[0].address,
    addressLocality: 'Cesena',
    postalCode: '47522',
    addressRegion: 'FC',
    addressCountry: 'IT',
  },
  areaServed: 'Emilia-Romagna, Italy',
  founder: {
    '@type': 'Person',
    name: 'Avv. Luca Ferrini',
  },
};
---

<!doctype html>
<html lang={lang} class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ctext x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='48' font-family='monospace' fill='%23FFD700'%3E%CE%A6%3C/text%3E%3C/svg%3E"
    />
    <meta name="generator" content={Astro.generator} />

    {
      GA_MEASUREMENT_ID && (
        <>
          <script is:inline async src={`https://www.googletagmanager.com/gtag/js?id=${GA_MEASUREMENT_ID}`} />
          <script
            is:inline
            set:html={`
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', '${GA_MEASUREMENT_ID}');
          `}
          />
        </>
      )
    }

    <!-- SEO Meta Tags -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="robots" content={robots} />
    <link rel="canonical" href={fullUrl} />

    <!-- Hreflang Tags -->
    <link rel="alternate" hreflang="en" href={`${siteUrl}/en${currentPath.replace('/en', '').replace('/it', '')}`} />
    <link rel="alternate" hreflang="it" href={`${siteUrl}/it${currentPath.replace('/en', '').replace('/it', '')}`} />
    <link
      rel="alternate"
      hreflang="x-default"
      href={`${siteUrl}/it${currentPath.replace('/en', '').replace('/it', '')}`}
    />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={fullUrl} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={`${siteUrl}/images/gustice.avif`} />
    <meta property="og:locale" content={lang === 'en' ? 'en_US' : 'it_IT'} />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={fullUrl} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={`${siteUrl}/images/gustice.avif`} />

    <!-- Telegram -->
    <meta property="telegram:image" content={`${siteUrl}/images/gustice.avif`} />
    <meta property="telegram:title" content={title} />
    <meta property="telegram:description" content={description} />

    <!-- WhatsApp (uses Open Graph but these help with better previews) -->
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content={title} />
    <meta property="og:site_name" content="Studio Legale Ferrini" />

    <!-- Structured Data -->
    <script type="application/ld+json" is:inline set:html={JSON.stringify(structuredData)} />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="font-sans antialiased">
    <slot />
  </body>
</html>
